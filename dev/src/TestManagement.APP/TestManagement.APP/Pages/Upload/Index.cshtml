@page
@model IndexModel
@{
    ViewData["Title"] = "ファイルアップロード";
}

<div class="container">
    <form method="post" enctype="multipart/form-data">
        <div class="block">
            @if (!Model.ModelState.IsValid)
            {
                <div style="color:#e74c3c; margin-bottom:12px;">
                    @foreach (var err in Model.ModelState.Values.SelectMany(v => v.Errors))
                    {
                        <div>@err.ErrorMessage</div>
                    }
                </div>
            }
            <div class="block-title">テスト結果の登録</div>
            <div style="display:flex; flex-direction:column; gap:16px;">
                <div class="card" style="margin:0; border-width: thin">
                    <div class="card-title">テストレベルを選択</div>
                    <div style="margin-bottom:8px;">
                        @if (Model.TestLevels != null && Model.TestLevels.Any())
                        {
                            <div style="margin:0;">
                                <select id="testLevelSelect" asp-for="SelectedTestLevelId" style="flex:0 0 20%; display:block; max-width:50%; padding:8px; margin-top:6px;">
                                    <option value="">選択してください</option>
                                    @foreach (var level in Model.TestLevels)
                                    {
                                        <option value="@level.Id">
                                            @level.Name @if(!string.IsNullOrWhiteSpace(level.Description)) {
                                                <text>- @level.Description</text>
                                            }
                                        </option>
                                    }
                                </select>
                            </div>
                        }
                        else
                        {
                            <div style="color:#e74c3c; margin:8px 0;">テストレベルを取得できませんでした。</div>
                        }
                    </div>

                    <!-- ここにドロップダウンを追加: テストレベル選択領域の下 -->
                    <div style="margin:0 12px 8px 0;">
                        <div class="card-title">既存の実行情報を指定（リビジョン - 日付）</div>

                        @if (Model.ExecutionInfos != null && Model.ExecutionInfos.Any())
                        {
                            <select id="executionInfoSelect" asp-for="SelectedExecutionInfoId" style="flex:0 0 30%; display:block; max-width:60%; padding:8px; margin-top:6px;">
                                <option value="">選択してください</option>
                                @foreach (var info in Model.ExecutionInfos)
                                {
                                    <option value="@info.Id">リビジョン @info.Abstract - @info.ExecutedAt.ToString("yyyy/MM/dd HH:mm")</option>
                                }
                            </select>
                        }
                        else
                        {
                            <select id="executionInfoSelect" asp-for="SelectedExecutionInfoId" disabled style="flex:0 0 30%; display:block; max-width:60%; padding:8px; margin-top:6px;">
                                <option value="">実行情報がありません</option>
                            </select>
                        }

                        <div style="font-size:0.9em; color:#666; margin-top:6px;">※ 表示は「リビジョン番号 - 実行日時」です。選択肢はサーバ側のデータを使用します。</div>
                    </div>
                </div>

                <div class="card" style="margin:0; border-width: thin">
                    <div class="card-title">ファイルを選択</div>
                    <div style="margin:0;">
                        <input id="fileInput" type="file" asp-for="UploadFiles" multiple style="display:block; margin-top:6px;" />
                    </div>

                    <div style="margin-top:12px;">
                        <input type="submit" class="upload-btn" value="アップロード開始" />
                        <a asp-page="/Dashboard" style="margin-left:10px; text-decoration:none;">キャンセル</a>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>
